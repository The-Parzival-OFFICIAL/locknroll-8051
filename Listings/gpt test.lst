A51 MACRO ASSEMBLER  GPT_TEST                                                             03/11/2025 19:48:40 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
NO OBJECT MODULE REQUESTED
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE gpt test.a51 SET(SMALL) DEBUG PRINT(.\Listings\gpt test.lst) OBJECT(.\O
                      bjects\gpt test.obj) EP

LOC  OBJ            LINE     SOURCE

0030                   1     ORG 0030H
                       2     ; -----------------------------------------
                       3     ; Registers Usage:
                       4     ; R0, R1 -> Left half (L) of plaintext (user password)
                       5     ; R2, R3 -> Right half (R) of plaintext (user password)
                       6     ; R4, R5 -> Round Key (Ki)
                       7     ; R6     -> Round Counter
                       8     ; R7     -> Temporary storage
                       9     ; R8, R9 -> Left half (L) of stored password
                      10     ; R10, R11 -> Right half (R) of stored password
                      11     ; R12    -> Attempt Counter
                      12     ; -----------------------------------------
                      13     
0030                  14     START:
0030                  15         MOV R12, #05H            ; Set maximum attempts (5)
*** _________________________________^
*** ERROR #A45 IN 15 (gpt test.a51, LINE 15): UNDEFINED SYMBOL (PASS-2)
0033 116E             16         CALL LOAD_STORED_PASSWORD ; Load stored encrypted password from EEPROM
                      17     
0035                  18     ENTER_PASSWORD:
0035 11A6             19         CALL CHECK_RESET_SEQUENCE ; Check if user wants to reset password
0037 114A             20         CALL READ_PASSWORD        ; Get user input from keypad
0039 1153             21         CALL ENCRYPT_PASSWORD     ; Encrypt entered password
003B 115B             22         CALL VERIFY_PASSWORD      ; Compare encrypted input with stored password
003D 6007             23         JZ ACCESS_GRANTED         ; If match, unlock door
                      24     
003F                  25         DJNZ R12, ENTER_PASSWORD  ; If wrong, retry (max 5 times)
*** __________________________________^
*** ERROR #A45 IN 25 (gpt test.a51, LINE 25): UNDEFINED SYMBOL (PASS-2)
0042 117B             26         CALL LOCKDOWN             ; Lock system after 5 failed attempts
0044 80FE             27         SJMP $
                      28     
0046                  29     ACCESS_GRANTED:
0046 118A             30         CALL UNLOCK_DOOR          ; Open the door
0048 80FE             31         SJMP $
                      32     
                      33     ; -----------------------------------------
                      34     ; Reads 4-digit password from keypad
                      35     ; -----------------------------------------
004A                  36     READ_PASSWORD:
                      37         ; Placeholder: Read from keypad
004A 7812             38         MOV R0, #12H   ; Example input 0x1234
004C 7934             39         MOV R1, #34H
004E 7A56             40         MOV R2, #56H   ; Example input 0x5678
0050 7B78             41         MOV R3, #78H
0052 22               42         RET
                      43     
                      44     ; -----------------------------------------
                      45     ; Encrypts the entered password using SPECK 32/64
                      46     ; -----------------------------------------
0053                  47     ENCRYPT_PASSWORD:
0053 9000F8           48         MOV DPTR , #KEY          ; Load encryption key
0056 11F3             49         CALL KEY_EXPANSION       ; Expand key before encryption
0058 11CF             50         CALL ENCRYPTION          ; Encrypt user input
005A 22               51         RET
                      52     
                      53     ; -----------------------------------------
A51 MACRO ASSEMBLER  GPT_TEST                                                             03/11/2025 19:48:40 PAGE     2

                      54     ; Compares encrypted input with stored encrypted password
                      55     ; -----------------------------------------
005B                  56     VERIFY_PASSWORD:
005B E8               57         MOV A, R0
005C                  58         CJNE A, R8, NOT_MATCH
*** _____________________________________^
*** ERROR #A45 IN 58 (gpt test.a51, LINE 58): UNDEFINED SYMBOL (PASS-2)
005F E9               59         MOV A, R1
0060                  60         CJNE A, R9, NOT_MATCH
*** _____________________________________^
*** ERROR #A45 IN 60 (gpt test.a51, LINE 60): UNDEFINED SYMBOL (PASS-2)
0063 EA               61         MOV A, R2
0064                  62         CJNE A, R10, NOT_MATCH
*** _____________________________________^
*** ERROR #A45 IN 62 (gpt test.a51, LINE 62): UNDEFINED SYMBOL (PASS-2)
0067 EB               63         MOV A, R3
0068                  64         CJNE A, R11, NOT_MATCH
*** _____________________________________^
*** ERROR #A45 IN 64 (gpt test.a51, LINE 64): UNDEFINED SYMBOL (PASS-2)
006B E4               65         CLR A                     ; Set Zero flag (match found)
006C 22               66         RET
                      67     
006D                  68     NOT_MATCH:
006D                  69         SETB A                    ; Clear Zero flag (no match)
*** __________________________________^
*** ERROR #A40 IN 69 (gpt test.a51, LINE 69): INVALID REGISTER
006D 22               70         RET
                      71     
                      72     ; -----------------------------------------
                      73     ; Load stored encrypted password from EEPROM
                      74     ; -----------------------------------------
006E                  75     LOAD_STORED_PASSWORD:
006E                  76         MOV R8, 50H  ; Load stored encrypted password (Left half)
*** _________________________________^
*** ERROR #A45 IN 76 (gpt test.a51, LINE 76): UNDEFINED SYMBOL (PASS-2)
0071                  77         MOV R9, 51H
*** _________________________________^
*** ERROR #A45 IN 77 (gpt test.a51, LINE 77): UNDEFINED SYMBOL (PASS-2)
0074                  78         MOV R10, 52H ; Load stored encrypted password (Right half)
*** _________________________________^
*** ERROR #A45 IN 78 (gpt test.a51, LINE 78): UNDEFINED SYMBOL (PASS-2)
0077                  79         MOV R11, 53H
*** _________________________________^
*** ERROR #A45 IN 79 (gpt test.a51, LINE 79): UNDEFINED SYMBOL (PASS-2)
007A 22               80         RET
                      81     
                      82     ; -----------------------------------------
                      83     ; Lock the system after 5 failed attempts
                      84     ; -----------------------------------------
007B                  85     LOCKDOWN:
                      86         ; Display "LOCKED" on LCD
007B 900083           87         MOV DPTR, #LOCK_MSG
007E                  88         CALL DISPLAY_LCD
*** __________________________________^
*** ERROR #A45 IN 88 (gpt test.a51, LINE 88): UNDEFINED SYMBOL (PASS-2)
0081 80FE             89         SJMP $ ; Halt system
                      90     
0083                  91     LOCK_MSG:
0083 4C4F434B         92         DB "LOCKED", 00H
0087 454400                  
                      93     
                      94     ; -----------------------------------------
                      95     ; Unlock door
                      96     ; -----------------------------------------
008A                  97     UNLOCK_DOOR:
                      98         ; Display "ACCESS GRANTED" on LCD
A51 MACRO ASSEMBLER  GPT_TEST                                                             03/11/2025 19:48:40 PAGE     3

008A 900097           99         MOV DPTR, #ACCESS_MSG
008D                 100         CALL DISPLAY_LCD
*** __________________________________^
*** ERROR #A45 IN 100 (gpt test.a51, LINE 100): UNDEFINED SYMBOL (PASS-2)
                     101     
                     102         ; Open door (Motor Control)
0090 D290            103         SETB P1.0  ; Motor ON (example)
0092                 104         ACALL DELAY
*** ___________________________________^
*** ERROR #A45 IN 104 (gpt test.a51, LINE 104): UNDEFINED SYMBOL (PASS-2)
0094 C290            105         CLR P1.0   ; Motor OFF
0096 22              106         RET
                     107     
0097                 108     ACCESS_MSG:
0097 41434345        109         DB "ACCESS GRANTED", 00H
009B 53532047                
009F 52414E54                
00A3 454400                  
                     110     
                     111     ; -----------------------------------------
                     112     ; Check for password reset sequence (e.g., holding '*' for 3s)
                     113     ; -----------------------------------------
00A6                 114     CHECK_RESET_SEQUENCE:
                     115         ; Placeholder: Detect special keypad sequence
00A6 20B201          116         JB P3.2, RESET_PASSWORD   ; If '*' key is pressed for reset
00A9 22              117         RET
                     118     
                     119     ; -----------------------------------------
                     120     ; Reset password process
                     121     ; -----------------------------------------
00AA                 122     RESET_PASSWORD:
00AA 9000B7          123         MOV DPTR, #RESET_MSG
00AD                 124         CALL DISPLAY_LCD
*** __________________________________^
*** ERROR #A45 IN 124 (gpt test.a51, LINE 124): UNDEFINED SYMBOL (PASS-2)
00B0 114A            125         CALL READ_PASSWORD       ; Get new password from user
00B2 1153            126         CALL ENCRYPT_PASSWORD    ; Encrypt the new password
00B4 11C6            127         CALL STORE_PASSWORD      ; Save encrypted password to EEPROM
00B6 22              128         RET
                     129     
00B7                 130     RESET_MSG:
00B7 52455345        131         DB "RESET PASSWORD", 00H
00BB 54205041                
00BF 5353574F                
00C3 524400                  
                     132     
                     133     ; -----------------------------------------
                     134     ; Store encrypted password in EEPROM
                     135     ; -----------------------------------------
00C6                 136     STORE_PASSWORD:
00C6 8850            137         MOV 50H, R0  ; Store encrypted password (Left half)
00C8 8951            138         MOV 51H, R1
00CA 8A52            139         MOV 52H, R2  ; Store encrypted password (Right half)
00CC 8B53            140         MOV 53H, R3
00CE 22              141         RET
                     142     
                     143     ; -----------------------------------------
                     144     ; Encryption Process (SPECK 32/64)
                     145     ; -----------------------------------------
00CF                 146     ENCRYPTION:
00CF 7E16            147         MOV R6, #22
00D1                 148     ENC_LOOP:
00D1 11EC            149         CALL LOAD_ROUND_KEY
00D3 11D8            150         CALL ROUND_FUNCTION 
00D5 DEFA            151         DJNZ R6 , ENC_LOOP
00D7 22              152         RET
A51 MACRO ASSEMBLER  GPT_TEST                                                             03/11/2025 19:48:40 PAGE     4

                     153             
00D8                 154     ROUND_FUNCTION:
00D8 EB              155         MOV A, R3 
00D9 C4              156         SWAP A
00DA FB              157         MOV R3,A
                     158         
00DB EA              159         MOV A,R2
00DC 68              160         XRL A,R0
00DD FA              161         MOV R2,A
                     162         
00DE EA              163         MOV A, R2
00DF 28              164         ADD A, R0
00E0 F8              165         MOV R0, A
                     166         
00E1 E8              167         MOV A , R0 
00E2 33              168         RLC A
00E3 33              169         RLC A
00E4 33              170         RLC A 
00E5 F8              171         MOV R0, A 
                     172         
00E6 E9              173         MOV A , R1
00E7 33              174         RLC A 
00E8 33              175         RLC A 
00E9 33              176         RLC A
00EA F9              177         MOV R1,A 
00EB 22              178         RET 
                     179     
00EC                 180     LOAD_ROUND_KEY:
00EC EC              181         MOV A,R4 
00ED 6A              182         XRL A, R2
00EE FC              183         MOV R4, A
                     184         
00EF ED              185         MOV A,R5 
00F0 6B              186         XRL A, R3
00F1 FD              187         MOV R5, A
00F2 22              188         RET
                     189     
00F3                 190     KEY_EXPANSION:
00F3 7CDE            191         MOV R4, #0DEH
00F5 7DAD            192         MOV R5, #0ADH
00F7 22              193         RET
                     194     
00F8                 195     KEY:
00F8 DEADBEEF        196         DB 0DEH, 0ADH, 0BEH, 0EFH, 0CAH, 0FEH , 0BAH , 0BEH
00FC CAFEBABE                
                     197     END
A51 MACRO ASSEMBLER  GPT_TEST                                                             03/11/2025 19:48:40 PAGE     5

SYMBOL TABLE LISTING
------ ----- -------


N A M E               T Y P E  V A L U E   ATTRIBUTES

ACCESS_GRANTED . . .  C ADDR   0046H   A   
ACCESS_MSG . . . . .  C ADDR   0097H   A   
CHECK_RESET_SEQUENCE  C ADDR   00A6H   A   
DELAY. . . . . . . .    ----   -----       
DISPLAY_LCD. . . . .    ----   -----       
ENCRYPTION . . . . .  C ADDR   00CFH   A   
ENCRYPT_PASSWORD . .  C ADDR   0053H   A   
ENC_LOOP . . . . . .  C ADDR   00D1H   A   
ENTER_PASSWORD . . .  C ADDR   0035H   A   
KEY. . . . . . . . .  C ADDR   00F8H   A   
KEY_EXPANSION. . . .  C ADDR   00F3H   A   
LOAD_ROUND_KEY . . .  C ADDR   00ECH   A   
LOAD_STORED_PASSWORD  C ADDR   006EH   A   
LOCKDOWN . . . . . .  C ADDR   007BH   A   
LOCK_MSG . . . . . .  C ADDR   0083H   A   
NOT_MATCH. . . . . .  C ADDR   006DH   A   
P1 . . . . . . . . .  D ADDR   0090H   A   
P3 . . . . . . . . .  D ADDR   00B0H   A   
R10. . . . . . . . .    ----   -----       
R11. . . . . . . . .    ----   -----       
R12. . . . . . . . .    ----   -----       
R8 . . . . . . . . .    ----   -----       
R9 . . . . . . . . .    ----   -----       
READ_PASSWORD. . . .  C ADDR   004AH   A   
RESET_MSG. . . . . .  C ADDR   00B7H   A   
RESET_PASSWORD . . .  C ADDR   00AAH   A   
ROUND_FUNCTION . . .  C ADDR   00D8H   A   
START. . . . . . . .  C ADDR   0030H   A   
STORE_PASSWORD . . .  C ADDR   00C6H   A   
UNLOCK_DOOR. . . . .  C ADDR   008AH   A   
VERIFY_PASSWORD. . .  C ADDR   005BH   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 15 ERROR(S)
